<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dix Autrement | Diagnostic Stratégique EGALIM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500&display=swap" rel-stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brandDark: '#405F59',
                        brandLight: '#549e39',
                        brandBg: '#f3f3f3',
                        brandSecondary: '#88a8a2',
                    },
                    fontFamily: {
                        sans: ['Georgia', 'serif'],
                        display: ['Oswald', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Fond transparent pour se fondre dans Strikingly */
        body {
            background-color: transparent; 
            color: #405F59;
            /* Hauteur ajustée pour garantir le défilement complet */
            min-height: 1200px; 
            padding-bottom: 50px;
            overflow-y: scroll; /* Assure le défilement si nécessaire */
        }

        /* Titres, boutons, etc. qui doivent être en Oswald */
        h1, h2, h3, h4, .nav-item, .btn-text, .font-display {
            font-family: 'Oswald', sans-serif !important;
            text-transform: uppercase;
            font-weight: 400;
        }
        
        /* Correction critique pour H1 qui n'héritait pas correctement */
        h1 {
            font-family: 'Oswald', sans-serif !important;
        }

        p, li, span, div {
            font-family: 'Georgia', serif;
        }

        /* Hauteur par défaut pour les graphiques */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
        /* Hauteur ajustée pour les graphiques en 3 colonnes */
        .chart-container-small {
            height: 200px;
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(64, 95, 89, 0.15);
        }

        /* Style pour le bouton actif (VERT) */
        .step-active {
            border-color: #549e39 !important;
            background-color: #ffffff !important;
            color: #549e39 !important;
            box-shadow: 0 0 10px rgba(84, 158, 57, 0.3); /* Ombre légère pour le statut actif */
        }
        /* Style pour les boutons inactifs ou en survol */
        .step-inactive {
            background-color: transparent;
            color: #405F59;
            border-color: #405F59;
        }
        .step-inactive:hover:not(.step-active) {
            background-color: #f0f0f0; /* Grisé au survol */
        }
        
        html { scroll-behavior: smooth; }
        
        /* Ajustement des marges des sections */
        section {
            padding-top: 50px !important;
            padding-bottom: 50px !important;
        }
        
        /* Style pour les blocs logos (CORRECTION FINALE) */
        .logo-ref-block {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem; /* Padding augmenté */
            min-height: 150px; /* Hauteur minimale augmentée */
            height: auto; 
            border: 1px solid #405F59;
            background-color: white;
            transition: all 0.3s;
            overflow: hidden; /* Empêche les débordements */
        }
        .logo-ref-block:hover {
            border-color: #549e39;
        }
        
        /* L'image peut maintenant prendre 100% de la hauteur du conteneur */
        .logo-ref-block img,
        .logo-ref-block svg {
            max-height: 100%; 
            max-width: 95%; 
            width: auto;
            object-fit: contain; 
            filter: grayscale(100%);
            transition: filter 0.3s;
        }
        .logo-ref-block:hover img,
        .logo-ref-block:hover svg {
            filter: grayscale(0%);
        }
        
        /* Style spécifique pour le texte dans les placeholders SVG */
        .logo-ref-block svg text {
            fill: #405F59; /* brandDark */
            font-family: 'Oswald', sans-serif;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Style pour les boutons de simulation actif/inactif */
        .btn-simulation-active {
            background-color: #405F59 !important;
            color: white !important;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
        }
        .btn-simulation-inactive {
            background-color: #E0E0E0 !important;
            color: #405F59 !important;
        }

    </style>
</head>
<body class="antialiased">

    <!-- Hero Section -->
    <header class="pt-4 pb-20 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto text-center">
        <div class="inline-block border border-brandDark px-4 py-1 mb-6 text-sm tracking-widest uppercase font-display text-brandDark">
            Restauration Collective Publique
        </div>
        <!-- AJOUT DE font-display À CETTE LIGNE POUR FORCER OSWALD -->
        <h1 class="text-5xl md:text-7xl text-brandDark mb-8 leading-tight font-display">
            Diagnostic Stratégique <br><span class="text-brandLight">EGALIM</span>
        </h1>
        <p class="text-xl md:text-2xl text-brandDark max-w-3xl mx-auto mb-12 leading-relaxed">
            Un plan d'achats opérationnel en <span class="font-bold border-b-2 border-brandLight">10 jours</span> pour transformer vos obligations réglementaires en levier de performance.
        </p>
        <div class="flex flex-col sm:flex-row justify-center gap-6">
            <!-- Remplacement par un lien <a> pour fiabiliser le scroll -->
            <a href="#offre" class="bg-brandLight text-white px-8 py-4 text-xl shadow-lg hover:bg-brandDark transition transform hover:-translate-y-1 btn-text flex items-center justify-center">
                Découvrir l'Offre
            </a>
            <a href="#simulation" class="bg-transparent border-2 border-brandDark text-brandDark px-8 py-4 text-xl hover:bg-brandDark hover:text-white transition btn-text flex items-center justify-center">
                Voir la Simulation
            </a>
        </div>
    </header>

    <!-- Context Section -->
    <section id="contexte" class="bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl text-brandDark mb-4">Vos Défis Actuels</h2>
                <div class="w-24 h-1 bg-brandLight mx-auto mb-6"></div>
                <p class="text-lg text-brandDark max-w-2xl mx-auto">
                    Trois points de blocage majeurs identifiés dans les collectivités.
                </p>
            </div>

            <div class="grid md:grid-cols-3 gap-10">
                <!-- Card 1 -->
                <div class="bg-gray-50 p-10 border-t-4 border-brandDark card-hover cursor-pointer" onclick="toggleCard(1)">
                    <div class="mb-6 text-brandLight">
                        <i class="fas fa-balance-scale text-4xl"></i>
                    </div>
                    <h3 class="text-2xl text-brandDark mb-4">Conformité Complexe</h3>
                    <p class="text-brandDark mb-4 text-lg leading-relaxed" id="text-1-short">
                        Difficulté à calculer les taux réels (50% EGALIM / 20% Bio) et à fiabiliser la télédéclaration.
                    </p>
                    <div id="text-1-long" class="hidden pt-4 mt-4 border-t border-gray-200">
                        <p class="text-brandLight font-bold mb-2">NOTRE RÉPONSE :</p>
                        <p>Classification experte de 100% de vos lignes d'achats.</p>
                    </div>
                </div>

                <!-- Card 2 -->
                <div class="bg-gray-50 p-10 border-t-4 border-brandLight card-hover cursor-pointer" onclick="toggleCard(2)">
                    <div class="mb-6 text-brandLight">
                        <i class="fas fa-coins text-4xl"></i>
                    </div>
                    <h3 class="text-2xl text-brandDark mb-4">Risque Budgétaire</h3>
                    <p class="text-brandDark mb-4 text-lg leading-relaxed" id="text-2-short">
                        Crainte que l'augmentation de la qualité ne fasse exploser le coût matière par repas.
                    </p>
                    <div id="text-2-long" class="hidden pt-4 mt-4 border-t border-gray-200">
                        <p class="text-brandLight font-bold mb-2">NOTRE RÉPONSE :</p>
                        <p>Scénarios chiffrés "Coût/Bénéfice" pour financer le Bio par l'optimisation.</p>
                    </div>
                </div>

                <!-- Card 3 -->
                <div class="bg-gray-50 p-10 border-t-4 border-brandDark card-hover cursor-pointer" onclick="toggleCard(3)">
                    <div class="mb-6 text-brandLight">
                        <i class="fas fa-eye-slash text-4xl"></i>
                    </div>
                    <h3 class="text-2xl text-brandDark mb-4">Opacité</h3>
                    <p class="text-brandDark mb-4 text-lg leading-relaxed" id="text-3-short">
                        Manque de visibilité sur les familles de produits, leur niveau de transformation et la conformité des titulaires de marché.
                    </p>
                    <div id="text-3-long" class="hidden pt-4 mt-4 border-t border-gray-200">
                        <p class="text-brandLight font-bold mb-2">NOTRE RÉPONSE :</p>
                        <p>Audit de performance complet incluant la vérification de la conformité du titulaire du marché aux engagements EGALIM.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Methodology Section -->
    <section id="methodologie" class="bg-brandBg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl text-brandDark mb-2">Méthodologie : Sprint 10 Jours</h2>
                <div class="w-24 h-1 bg-brandLight mx-auto mt-4"></div>
            </div>

            <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-12">
                <!-- Les classes step-inactive et hover:bg-gray-100 sont ajoutées pour le comportement souhaité -->
                <!-- Jours 1-2 (COLLECTE) -->
                <button onclick="setPhase(1)" id="btn-phase-1" class="w-full md:w-auto px-8 py-4 border transition step-active step-inactive text-left md:text-center hover:bg-gray-100">
                    <span class="block text-xs uppercase opacity-70 font-sans">Jours 1-2</span>
                    <span class="font-display text-xl">COLLECTE</span>
                </button>
                <div class="hidden md:block w-8 h-px bg-brandDark"></div>
                <!-- Jours 3-5 (DIAGNOSTIC) -->
                <button onclick="setPhase(2)" id="btn-phase-2" class="w-full md:w-auto px-8 py-4 border transition step-inactive text-left md:text-center hover:bg-gray-100">
                    <span class="block text-xs uppercase opacity-70 font-sans">Jours 3-5</span>
                    <span class="font-display text-xl">DIAGNOSTIC</span>
                </button>
                <div class="hidden md:block w-8 h-px bg-brandDark"></div>
                <!-- Jours 6-8 (STRATÉGIE) -->
                <button onclick="setPhase(3)" id="btn-phase-3" class="w-full md:w-auto px-8 py-4 border transition step-inactive text-left md:text-center hover:bg-gray-100">
                    <span class="block text-xs uppercase opacity-70 font-sans">Jours 6-8</span>
                    <span class="font-display text-xl">STRATÉGIE</span>
                </button>
                <div class="hidden md:block w-8 h-px bg-brandDark"></div>
                <!-- Jours 9-10 (RESTITUTION) -->
                <button onclick="setPhase(4)" id="btn-phase-4" class="w-full md:w-auto px-8 py-4 border transition step-inactive text-left md:text-center hover:bg-gray-100">
                    <span class="block text-xs uppercase opacity-70 font-sans">Jours 9-10</span>
                    <span class="font-display text-xl">RESTITUTION</span>
                </button>
            </div>

            <div class="bg-white p-10 md:p-14 border border-brandDark shadow-xl transition-all duration-300" id="phase-content">
            </div>
        </div>
    </section>

    <!-- Simulation Dashboard -->
    <section id="simulation" class="bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl text-brandDark mb-2">Simulation des Résultats</h2>
                <div class="w-24 h-1 bg-brandLight mx-auto mt-4"></div>
                <p class="text-lg text-brandDark max-w-2xl mx-auto mt-4">
                    Visualisez l'impact de notre stratégie sur vos indicateurs clés.
                </p>
            </div>

            <!-- RESTAURATION STRUCTURE 2 COLONNES -->
            <!-- items-start a été remplacé par items-center pour aligner verticalement les deux colonnes -->
            <div class="grid lg:grid-cols-2 gap-16 items-center">
                
                <!-- COLONNE 1 (GAUCHE) : Descriptif -->
                <div class="col-span-1">
                    <h3 class="text-3xl text-brandDark mt-2 mb-6 font-display">Outils de pilotage</h3>
                    <p class="text-lg text-brandDark mb-8 leading-relaxed">
                        Nous ne vous livrons pas seulement un rapport, mais des outils de pilotage visuels pour comprendre vos leviers d'économies.
                    </p>
                    
                    <div class="space-y-6">
                        <div class="flex items-start gap-5">
                            <div class="text-brandLight mt-1">
                                <i class="fas fa-chart-pie text-2xl"></i>
                            </div>
                            <div>
                                <h4 class="text-xl text-brandDark mb-1 font-display">Bilan de Conformité</h4>
                                <p class="text-brandDark opacity-80">Visualisation claire des écarts par rapport aux objectifs EGALIM.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5">
                            <div class="text-brandLight mt-1">
                                <i class="fas fa-euro-sign text-2xl"></i>
                            </div>
                            <div>
                                <h4 class="text-xl text-brandDark mb-1 font-display">Projection Budgétaire</h4>
                                <p class="text-brandDark opacity-80">Comparaison du coût actuel vs coût optimisé.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-5">
                            <div class="text-brandLight mt-1">
                                <i class="fas fa-boxes text-2xl"></i>
                            </div>
                            <div>
                                <h4 class="text-xl text-brandDark mb-1 font-display">Ventilation des Produits</h4>
                                <p class="text-brandDark opacity-80">Démonstration de la réallocation des volumes d'achats vers les familles de produits durables.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- COLONNE 2 (DROITE) : Graphiques Interactifs -->
                <div class="bg-brandBg p-8 border border-brandDark col-span-1">
                    <div class="mb-6 flex justify-between items-center border-b border-brandDark pb-4">
                        <h3 class="font-display text-xl text-brandDark">Outils de pilotage</h3>
                        <div class="flex gap-2">
                            <button id="btn-initial" onclick="updateCharts('initial')" class="text-xs font-display uppercase tracking-wider px-3 py-2 transition btn-simulation-active">Situation Initiale</button>
                            <button id="btn-optimized" onclick="updateCharts('optimized')" class="text-xs font-display uppercase tracking-wider px-3 py-2 transition btn-simulation-inactive">Après Stratégie</button>
                        </div>
                    </div>

                    <div class="grid gap-6">
                         <!-- Chart 1: Compliance (Full width) -->
                        <div class="bg-white p-4 border border-gray-200">
                            <!-- Titre h4 retiré car dupliqué par Chart.js -->
                            <div class="chart-container chart-container-small">
                                <canvas id="complianceChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Chart 2: Cost Analysis (Full width) -->
                        <div class="bg-white p-4 border border-gray-200">
                            <!-- Titre h4 retiré car dupliqué par Chart.js -->
                            <div class="chart-container chart-container-small">
                                <canvas id="costChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Chart 3: Family Volume (Barres empilées) -->
                        <div class="bg-white p-4 border border-gray-200">
                            <!-- Titre h4 retiré car dupliqué par Chart.js -->
                            <div class="chart-container">
                                <canvas id="familyVolumeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- References -->
    <section id="references" class="bg-brandDark text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-4xl text-white mb-12">Ils nous font confiance</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-center">
                
                <!-- Logo 1: Métropole de Lyon (URL Rétablie vers une version simple) -->
                <div class="logo-ref-block">
                    <!-- Suppression de la classe h-10 -->
                    <img src="https://www.lyoncapitale.fr/wp-content/uploads/2022/09/logo-metropole-grand-lyon-580x203.png" 
                         alt="Logo Métropole de Lyon" 
                         class="w-auto object-contain"
                         onerror="this.src='https://placehold.co/120x60/FFFFFF/405F59/png?text=M%C3%A9tropole+Lyon'">
                </div>
                
                <!-- Logo 2: Bordeaux Métropole (URL Rétablie vers une version simple) -->
                <div class="logo-ref-block">
                    <!-- Suppression de la classe h-10 -->
                    <img src="https://grapheine.com/wp-content/uploads/2015/01/logo-bordeaux-metropole1-1024x425.webp" 
                         alt="Logo Bordeaux Métropole" 
                         class="w-auto object-contain"
                         onerror="this.src='https://placehold.co/120x60/FFFFFF/405F59/png?text=Bordeaux+M%C3%A9tropole'">
                </div>
                
                <!-- Logo 3: Grand Paris Sud (URL Rétablie vers une version simple) -->
                <div class="logo-ref-block">
                    <!-- Suppression de la classe h-10 -->
                    <img src="https://static.neopse.com/medias/p/2144/site/43/27/15/432715687066024f603d4cc777bb15e74c6a218f.jpg?v=v1" 
                         alt="Logo Grand Paris Sud" 
                         class="w-auto object-contain"
                         onerror="this.src='https://placehold.co/120x60/FFFFFF/405F59/png?text=Grand+Paris+Sud'">
                </div>
                
                <!-- Logo 4: Val de Garonne (URL Fichier Source) -->
                <div class="logo-ref-block">
                    <!-- Suppression de la classe h-10 -->
                    <img src="https://valdegaronne.fr/uploads/Eam/mod-1/logo.png" 
                         alt="Logo Val de Garonne" 
                         class="w-auto object-contain"
                         onerror="this.src='https://placehold.co/120x60/FFFFFF/405F59/png?text=Val+de+Garonne'">
                </div>
                
                <!-- Logo 5: Ceinture Aliment-Terre de Liège (URL Rétablie vers une version simple) -->
                <div class="logo-ref-block">
                    <!-- Suppression de la classe h-10 -->
                    <img src="https://s2.qwant.com/thumbr/474x225/d/2/bf5ad87117900ed771247e99f40f6157aa99f82197779c81834fd1886bcf31/OIP.M13IJL0DcPq0TrR45BoBhwHaDh.jpg?u=https%3A%2F%2Ftse.mm.bing.net%2Fth%2Fid%2FOIP.M13IJL0DcPq0TrR45BoBhwHaDh%3Fpid%3DApi&q=0&b=1&p=0&a=0" 
                         alt="Logo Ceinture Aliment-Terre de Liège" 
                         class="w-auto object-contain"
                         onerror="this.src='https://placehold.co/120x60/FFFFFF/405F59/png?text=Ceinture+Li%C3%A8ge'">
                </div>

            </div>

            <div class="mt-16">
                <!-- LIEN MIS À JOUR EN BOUTON -->
                <a href="https://www.dix-autrement.fr/references" target="_blank" class="bg-brandLight text-white px-8 py-3 text-xl shadow-lg hover:bg-brandDark transition transform hover:-translate-y-0.5 btn-text">
                    Voir nos références détaillées
                </a>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="offre" class="bg-brandBg">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white border-2 border-brandDark overflow-hidden">
                <div class="bg-brandDark text-white p-10 text-center">
                    <h2 class="text-4xl text-brandDark text-white font-display">L'Offre Diagnostic Approfondi</h2>
                    <p class="font-sans text-brandLight mt-2 text-lg">Forfait Tout Compris - 10 Jours Ouvrables</p>
                </div>
                
                <div class="p-10 md:p-14">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-10 border-b border-gray-200 pb-10">
                        <div>
                            <ul class="space-y-4 text-brandDark text-lg">
                                <li class="flex items-center"><i class="fas fa-check text-brandLight mr-4"></i> Analyse complète de conformité EGALIM</li>
                                <li class="flex items-center"><i class="fas fa-check text-brandLight mr-4"></i> Matrice d'arbitrage budgétaire</li>
                                <li class="flex items-center"><i class="fas fa-check text-brandLight mr-4"></i> Plan de pénétration Bio & SIQO</li>
                                <!-- Libellé mis à jour : Bio et SIQO -->
                                <li class="flex items-center"><i class="fas fa-check text-brandLight mr-4"></i> Audit de performance</li>
                            </ul>
                        </div>
                        <div class="mt-8 md:mt-0 text-center md:text-right">
                            <span class="block text-6xl font-display text-brandLight">4 900 € <span class="text-2xl text-brandDark">HT</span></span>
                            <span class="text-brandDark font-sans">Mission complète</span>
                        </div>
                    </div>

                    <div class="text-center">
                        <!-- BOUTON LIEN FORMULAIRE MIS À JOUR -->
                        <a href="https://www.dix-autrement.fr/RDV" 
                            class="bg-brandLight text-white px-12 py-5 text-xl font-display uppercase tracking-wider hover:bg-brandDark shadow-lg transition transform hover:-translate-y-1 w-full md:w-auto">
                            Prendre RDV pour un échange
                        </a>
                        <!-- Ajout des coordonnées de contact direct -->
                        <div class="mt-6 text-brandDark space-y-1">
                            <p class="text-sm font-sans font-bold">Ou contacter directement :</p>
                            <p class="text-lg font-display">Pierre-Alain Mory</p>
                            <p class="text-sm font-sans"><a href="tel:0783000956" class="hover:underline">07 83 00 09 56</a></p>
                            <p class="text-sm font-sans"><a href="mailto:pierre.alain.mory@dix-autrement.fr" class="hover:underline">pierre.alain.mory@dix-autrement.fr</a></p>
                        </div>
                        <!-- Suppression du texte demandé -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // --- 1. DATA MOCKUP ---
        const initialComplianceData = { 
            compliance: [15, 30, 55], // Bio, Egalim, Standard
            cost: [1.80, 2.10, 2.50],
            costLabels: ['Coût Standard', 'Coût Durable', 'Coût Bio Cible'] 
        };
        const optimizedData = { 
            compliance: [22, 35, 43], 
            cost: [1.80, 1.40, 1.95],
            costLabels: ['Coût Standard', 'Végétal/Légum.', 'Bio Cible'] 
        };

        // Ventilation par Famille (anonymisées basées sur vos fichiers)
        const familyData = {
            // "Légumes Frais" corrigé en "Légumes"
            labels: ['Légumes', 'Viandes/Volaille', 'Féculents/Céréales', 'Produits Laitiers', 'Épicerie'],
            initialVolumes: [35, 20, 15, 12, 18], // Distribution initiale (pourcentage simplifié)
            optimizedVolumes: [45, 15, 18, 10, 12] // Redistribution vers Légumes (Bio) et Céréales (Marque de Qualité)
        };


        // --- 2. STATE & UI LOGIC ---
        const state = { currentPhase: 1, simulationMode: 'initial' };
        
        const phases = {
            // Durées ajustées sur 10 jours
            1: { title: "COLLECTE", desc: "Récupération et normalisation des exports.", icon: "fa-filter", details: ["Transmission sécurisée", "Classification par famille", "Identification des niveaux de transformation"], days: "Jours 1-2" },
            2: { title: "DIAGNOSTIC", desc: "Calcul précis des indicateurs de conformité.", icon: "fa-stethoscope", details: ["Calcul % Bio / Durable", "Identification des écarts", "Cartographie transformation"], days: "Jours 3-5" },
            // Texte mis à jour dans la stratégie
            3: { title: "STRATÉGIE", desc: "Analyse d'impact financier et scénarios.", icon: "fa-chess", details: ["Quantification Coût/Bénéfice", "Plan de pénétration Bio & SIQO", "Stratégie allotissement"], days: "Jours 6-8" },
            // Libellé mis à jour
            4: { title: "RESTITUTION", desc: "Remise du Plan Stratégique.", icon: "fa-file-signature", details: ["Rapport synthétique", "Plan d'actions correctives", "Présentation (1h30)"], days: "Jours 9-10" }
        };

        function setPhase(phaseId) {
            state.currentPhase = phaseId;
            
            // 1. Gérer l'état actif/inactif des boutons de phase
            document.querySelectorAll('[id^="btn-phase-"]').forEach(btn => {
                btn.classList.remove('step-active');
                btn.classList.add('step-inactive');
            });
            const activeBtn = document.getElementById(`btn-phase-${phaseId}`);
            activeBtn.classList.add('step-active');
            activeBtn.classList.remove('step-inactive'); // Retire la classe inactive de l'actif
            
            // 2. Mettre à jour le contenu
            const data = phases[phaseId];
            const container = document.getElementById('phase-content');
            container.innerHTML = `
                <div class="flex flex-col md:flex-row gap-8 items-center">
                    <div class="flex-shrink-0 text-brandLight">
                        <i class="fas ${data.icon} text-6xl"></i>
                    </div>
                    <div class="flex-grow text-center md:text-left">
                        <h3 class="text-3xl text-brandDark mb-4 font-display">${data.title}</h3>
                        <p class="text-brandDark text-xl mb-6">${data.desc}</p>
                        <div class="grid md:grid-cols-3 gap-4">
                            ${data.details.map(d => `<div class="bg-gray-50 p-4 border border-gray-200 flex items-center gap-3"><i class="fas fa-check text-brandLight"></i><span class="text-brandDark text-sm">${d}</span></div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // 3. Assurer que les libellés de jours sont corrects (re-assignation des jours)
            for (let id = 1; id <= 4; id++) {
                document.getElementById(`btn-phase-${id}`).querySelector('.font-sans').textContent = phases[id].days;
            }
        }

        function toggleCard(id) {
            const longText = document.getElementById(`text-${id}-long`);
            longText.classList.toggle('hidden');
        }

        // --- 3. CHART LOGIC ---
        let complianceChart, costChart, familyVolumeChart;

        function initCharts() {
            // Chart 1: Compliance (Doughnut)
            const ctx1 = document.getElementById('complianceChart').getContext('2d');
            complianceChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Bio', 'EGALIM (hors Bio)', 'Standard'],
                    datasets: [{ data: initialComplianceData.compliance, backgroundColor: ['#549e39', '#88a8a2', '#e0e0e0'], borderWidth: 0 }]
                },
                options: { 
                    plugins: { 
                        legend: { position: 'right', labels: { font: { family: 'Georgia' } } },
                        title: { display: true, text: 'Objectifs EGALIM (en valeur)', font: { family: 'Oswald', size: 14 } }
                    }, 
                    maintainAspectRatio: false 
                }
            });

            // Chart 2: Cost Analysis (Bar)
            const ctx2 = document.getElementById('costChart').getContext('2d');
            costChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: initialComplianceData.costLabels,
                    datasets: [{ label: 'Coût (€)', data: initialComplianceData.cost, backgroundColor: '#405F59', borderRadius: 0 }]
                },
                options: { 
                    scales: { y: { beginAtZero: true } },
                    plugins: { 
                        legend: { display: false },
                        title: { display: true, text: 'Coût Matière / Repas (€)', font: { family: 'Oswald', size: 14 } }
                    },
                    maintainAspectRatio: false
                }
            });

            // Chart 3: Family Volume (Stacked Bar Chart - Profil)
            const ctx3 = document.getElementById('familyVolumeChart').getContext('2d');
            familyVolumeChart = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: familyData.labels,
                    datasets: [
                        // Initial
                        {
                            label: 'Situation Initiale (%)',
                            data: familyData.initialVolumes,
                            backgroundColor: '#405F59', // brandDark
                            borderRadius: 4
                        },
                        // Optimized (Starts empty for initial view)
                        {
                            label: 'Après Stratégie (%)',
                            data: Array(familyData.labels.length).fill(0), 
                            backgroundColor: '#549e39', // brandLight
                            borderRadius: 4
                        }
                    ]
                },
                options: { 
                    indexAxis: 'y', // Barres horizontales pour un profil plus clair
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true }, // Empilé pour montrer la part de chaque famille
                        y: { stacked: true, beginAtZero: true }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { family: 'Georgia' } } },
                        title: { display: true, text: 'Ventilation des Volumes par Famille de Produits (%)', font: { family: 'Oswald', size: 14 } }
                    }
                }
            });
        }

        function updateCharts(mode) {
            const data = mode === 'initial' ? initialComplianceData : optimizedData;
            
            // 1. Update Compliance Chart
            complianceChart.data.datasets[0].data = data.compliance;
            complianceChart.update();

            // 2. Update Cost Chart
            costChart.data.labels = data.costLabels;
            costChart.data.datasets[0].data = data.cost;
            costChart.data.datasets[0].backgroundColor = mode === 'initial' ? '#405F59' : '#549e39';
            costChart.update();
            
            // 3. Update Family Volume Chart (Stacked Bar - Profile)
            if (mode === 'initial') {
                // Pour la vue initiale, seule la dataset 'Situation Initiale' est remplie
                familyVolumeChart.data.datasets[0].data = familyData.initialVolumes;
                familyVolumeChart.data.datasets[1].data = Array(familyData.labels.length).fill(0); 
            } else {
                 // Pour la vue optimisée, seule la dataset 'Après Stratégie' est remplie
                familyVolumeChart.data.datasets[0].data = Array(familyData.labels.length).fill(0);
                familyVolumeChart.data.datasets[1].data = familyData.optimizedVolumes;
            }
            familyVolumeChart.update();


            // 4. Update Button Colors
            document.getElementById('btn-initial').classList.remove('btn-simulation-active');
            document.getElementById('btn-initial').classList.add('btn-simulation-inactive');
            document.getElementById('btn-optimized').classList.remove('btn-simulation-active');
            document.getElementById('btn-optimized').classList.add('btn-simulation-inactive');

            if (mode === 'initial') {
                document.getElementById('btn-initial').classList.add('btn-simulation-active');
                document.getElementById('btn-initial').classList.remove('btn-simulation-inactive');
            } else {
                document.getElementById('btn-optimized').classList.add('btn-simulation-active');
                document.getElementById('btn-optimized').classList.remove('btn-simulation-inactive');
            }
        }

        document.addEventListener('DOMContentLoaded', () => { 
            setPhase(1); 
            initCharts();
            updateCharts('initial'); // Initialiser les boutons
        });
    </script>
</body>
</html>
